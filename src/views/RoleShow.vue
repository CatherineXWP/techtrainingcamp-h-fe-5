<template>
  <div class="main">
    <van-nav-bar
      title="角色展示"
      left-text="返回"
      left-arrow
      @click-left="onClickLeft"
    />
    <div class="showotherplayer">
      <div v-for="player in otherPlayers" :key="player.id" class="singlePlayer">
<!--        如果玩家死亡的话，class=died，头像变灰-->
        <img src="../assets/people.png" :class="{died: player.role_sta===2}">
        <label>{{player.name}}</label>
      </div>
    </div>

    <!--      等待其他玩家进入-->
    <div v-if="currentPlayer.rolestatus==0" class="preparing">
      <van-loading type="spinner" size="50">等待其他玩家进入</van-loading>
    </div>
    <!--      开始游戏了-->
    <div class="showcurrentplayer" v-else>
      <img :src="currentPlayer.playerimage">
      <div class="right">
        <span>你的身份:<label class="rolename">【 {{ currentPlayer.role }} 】</label></span>
        <div>
          <div class="status">
            <van-divider :style="{ color: '#14aea3', borderColor: '#ffffff', marginTop: '10px', marginBottom: '10px'}">游戏状态</van-divider>
            <label v-if="currentPlayer.rolestatus===0">游戏中</label>
            <label v-else>已死亡</label>
          </div>
          <van-divider :style="{ color: '#26c622', borderColor: '#ffffff', marginTop: '10px', marginBottom: '10px'}">角色技能</van-divider>
          <div>
            <span class="skill">【技能】：{{currentPlayer.playerskill}}</span>
          </div>
        </div>
      </div>
    </div>
    <!--      游戏结束了，显示胜利还是失败-->
    <van-overlay :show="currentPlayer.rolestatus==3 || currentPlayer.rolestatus==4" @click="toSelectMVP">
      <div class="overlay"  @click="currentPlayer.rolestatus==2">
        <div class="gameResult" v-if="currentPlayer.rolestatus==3"><p>您胜利了</p></div>
        <div class="gameResult" v-if="currentPlayer.rolestatus==4"><p>您失败了</p></div>
      </div>
    </van-overlay>
    <div class="bottom" v-show="1">
<!--      <van-button color="linear-gradient(to right, #6149f6, #4bb0ff)" @click="refreshStatus">刷新状态</van-button>-->
      <van-button color="linear-gradient(to right, #4bb0ff, #6149f6)" @click="outRoom">退出房间</van-button>
    </div>
  </div>
</template>

<script>
  import {Dialog} from 'vant';

  export default {
    name: "RoleShow.vue",
    data: function () {
      return {
        playerId: JSON.parse(window.localStorage.getItem("roleID")),//该房间当前玩家uuid
        currentPlayer: {
          roleId: this.$store.state.playerIndex,   //该玩家ID
          /*rolestatus: this.$store.state.playerStatus,  //该玩家状态(0---等待中，1--活，2--死，3--胜利，4--失败)
          rolename: this.$store.state.playerName, *///该玩家角色(1--村民、2--女巫、3--预言家、4--猎人、6--狼人)
          role: '',   //角色名,女巫、狼人等
          playerimage: '', //该玩家角色图片路径
          playerskill: '' ,//角色技能描述
            // //测试用例
             rolestatus: '3',
             rolename: 2,
        },
        otherPlayers:this.$store.state.Players, //其他玩家信息
      }
    },
    methods: {
        onClickLeft() {  //头部的返回
            this.$router.back();
        },
      //退出房间
      outRoom() {
        const playerId = this.playerId;
        Dialog.confirm({
          title: "",
          message: "确定退出吗"
        }).then(
          () => {
            this.$store.dispatch("OutRoom", playerId);
            this.$router.back();
          }
        ).catch(()=>{})
      },
      //状态刷新
      refreshStatus() {
        const playerId = this.playerId;
        this.$store.dispatch("refreshStatus", playerId)
      },
      //轮询
      loop() {
        const playerId = this.playerId;
        if (this.$route.path === "/roleshow") {
          setInterval(()=>{
            this.$store.dispatch("loopStatus", playerId);
          },3000);
        }
      },
        toSelectMVP(){   //玩家点击浮层，会进入选MVP的页面
            this.showResult = false;
            this.$router.push('/selectMVP');
        }
    },
    created() {
      let currPlayer = this.currentPlayer;

      if (currPlayer.rolename === 6) { //狼人
        currPlayer.playerimage = `/static/img/langren.jpg`;
        currPlayer.playerskill = '白天装作好人混淆视听，夜晚袭击村民，霸占村庄。';
        this.currentPlayer.role = '狼人';
      } else if (currPlayer.rolename === 1) { //村民
        currPlayer.playerimage = `/static/img/pingming.jpg`;
        currPlayer.playerskill = '无特殊技能，一觉睡到天亮。';
        this.currentPlayer.role = '村民';
      } else if (currPlayer.rolename === 3) { //预言家
        currPlayer.playerimage = `/static/img/yuyanjia.jpg`;
        currPlayer.playerskill = '每天晚上可以查验一名玩家的身份是好人还是狼人。';
        this.currentPlayer.role = '预言家';
      } else if (currPlayer.rolename === 2) { //女巫
        currPlayer.playerimage = `/static/img/nvwu.jpg`;
        currPlayer.playerskill = '女巫有两瓶药，解药可以救人，毒药可以杀人。';
        this.currentPlayer.role = '女巫';
      } else if (currPlayer.rolename === 4) { //猎人
        currPlayer.playerimage = `/static/img/lieren.jpg`;
        currPlayer.playerskill = '猎人死的时候可以带走场上任意一名玩家';
        this.currentPlayer.role = '猎人';
      }
      this.loop();

    }
  }
</script>

<style scoped>
  .main {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .header {
    background-color: #9999FF;
  }

  .died {
    -webkit-filter: grayscale(100%);
    -moz-filter: grayscale(100%);
    -o-filter: grayscale(100%);
    filter: grayscale(100%);
  }

  .showotherplayer {
    width: auto;
    height: auto;
    background-color: #fff;
    border-radius: 8px;
    border: 2px solid transparent;
    border-image: linear-gradient(to top, #F80, #2ED);
    /*border-image-slice: 10;*/
    margin-bottom: 1%;
  }

  .showcurrentplayer {
    height: auto;
    width: 100%;
    color: white;
    background-color: rgba(0, 0, 0, 0.7);
  }

  .right {
    width: 50%;
    float: right;
    font-size: 1rem;
    padding-top: 15%;
  }

  img {
    width: 50%;
  }

  .preparing {
    height: 30%;
    padding-top: 10%;
  }

  .status {
    height: 15%;
  }

  .rolename {
    color: red;
  }

  .status > label {
    height: 5%;
    color: red;
  }

  .bottom {
    width: 50%;
    position: absolute;
    bottom: -50px;
    left: 50%;
    transform: translateX(-50%);
  }

  button {
    border-radius: 8px;
    background-color: #87CEFA;
    color: white;
  }

  .otherPlayers {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
  }

  .singlePlayer {
    width: 20%;
    height: 15%;
    display: inline-block;
    margin: 5%;
  }

  .singlePlayer > img {
    width: 100%;
    height: 100%;
  }

  .skill {
    font-size: 0.8rem;
  }
  .overlay {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
  }

  .gameResult {
    width: 300px;
    height: 300px;
    background-color: #c6c6c6;
    /*position: relative;*/
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .gameResult>p{
    /*position: absolute;*/
    color: red;
    font-size: 2rem;
  }
</style>
